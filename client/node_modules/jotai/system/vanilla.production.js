System.register([],function(M){"use strict";return{execute:function(){M("atom",T);let R=0;function T(t,s){const l=`atom${++R}`,d={toString(){return l}};return typeof t=="function"?d.read=t:(d.init=t,d.read=U,d.write=$),s&&(d.write=s),d}function U(t){return t(this)}function $(t,s,l){return s(this,typeof l=="function"?l(t(this)):l)}const O=(t,s)=>t.unstable_is?t.unstable_is(s):s===t,W=t=>"init"in t,B=t=>!!t.write,b=new WeakMap,E=t=>{var s;return z(t)&&!((s=b.get(t))!=null&&s[1])},q=(t,s)=>{const l=b.get(t);l&&(l[1]=!0,l[0].forEach(d=>d(s)))},x=t=>{if(b.has(t))return;const s=[new Set,!1];b.set(t,s);const l=()=>{s[1]=!0};t.then(l,l),t.onCancel=d=>{s[0].add(d)}},z=t=>typeof(t==null?void 0:t.then)=="function",F=t=>"v"in t||"e"in t,A=t=>{if("e"in t)throw t.e;return t.v},G=(t,s,l)=>{l.p.has(t)||(l.p.add(t),s.then(()=>{l.p.delete(t)},()=>{l.p.delete(t)}))},H=(t,s,l,d,y)=>{var p;l.d.set(d,y.n),E(l.v)&&G(s,l.v,y),(p=y.m)==null||p.t.add(s),t&&J(t,d,s)},g=()=>[new Map,new Map,new Set],I=(t,s,l)=>{t[0].has(s)||t[0].set(s,new Set),t[1].set(s,l)},J=(t,s,l)=>{const d=t[0].get(s);d&&d.add(l)},K=(t,s)=>t[0].get(s),L=(t,s)=>{t[2].add(s)},S=t=>{for(;t[1].size||t[2].size;){t[0].clear();const s=new Set(t[1].values());t[1].clear();const l=new Set(t[2]);t[2].clear(),s.forEach(d=>{var y;return(y=d.m)==null?void 0:y.l.forEach(p=>p())}),l.forEach(d=>d())}},N=t=>{const s=(o,n,e)=>{const r="v"in n,f=n.v,c=E(n.v)?n.v:null;if(z(e)){x(e);for(const a of n.d.keys())G(o,e,t(a,n));n.v=e,delete n.e}else n.v=e,delete n.e;(!r||!Object.is(f,n.v))&&(++n.n,c&&q(c,e))},l=(o,n,e,r)=>{var f;if(F(e)&&(e.m&&!(r!=null&&r.has(n))||Array.from(e.d).every(([i,h])=>l(o,i,t(i,e),r).n===h)))return e;e.d.clear();let c=!0;const a=i=>{if(O(n,i)){const m=t(i,e);if(!F(m))if(W(i))s(i,m,i.init);else throw new Error("no atom init");return A(m)}const h=l(o,i,t(i,e),r);if(c)H(o,n,e,i,h);else{const m=g();H(m,n,e,i,h),k(m,n,e),S(m)}return A(h)};let v,u;const w={get signal(){return v||(v=new AbortController),v.signal},get setSelf(){return!u&&B(n)&&(u=(...i)=>{if(!c)return P(n,...i)}),u}};try{const i=n.read(a,w);if(s(n,e,i),z(i)){(f=i.onCancel)==null||f.call(i,()=>v==null?void 0:v.abort());const h=()=>{if(e.m){const m=g();k(m,n,e),S(m)}};i.then(h,h)}return e}catch(i){return delete e.v,e.e=i,++e.n,e}finally{c=!1}},d=o=>A(l(void 0,o,t(o))),y=(o,n,e)=>{var r,f;const c=new Map;for(const a of((r=e.m)==null?void 0:r.t)||[])c.set(a,t(a,e));for(const a of e.p)c.set(a,t(a,e));return(f=K(o,n))==null||f.forEach(a=>{c.set(a,t(a,e))}),c},p=(o,n,e)=>{const r=[],f=new Set,c=(v,u)=>{if(!f.has(v)){f.add(v);for(const[w,i]of y(o,v,u))v!==w&&c(w,i);r.push([v,u,u.n])}};c(n,e);const a=new Set([n]);for(let v=r.length-1;v>=0;--v){const[u,w,i]=r[v];let h=!1;for(const m of w.d.keys())if(m!==u&&a.has(m)){h=!0;break}h&&(l(o,u,w,f),k(o,u,w),i!==w.n&&(I(o,u,w),a.add(u))),f.delete(u)}},_=(o,n,e,...r)=>{const f=a=>A(l(o,a,t(a,e))),c=(a,...v)=>{const u=t(a,e);let w;if(O(n,a)){if(!W(a))throw new Error("atom not writable");const i="v"in u,h=u.v,m=v[0];s(a,u,m),k(o,a,u),(!i||!Object.is(h,u.v))&&(I(o,a,u),p(o,a,u))}else w=_(o,a,u,...v);return S(o),w};return n.write(f,c,...r)},P=(o,...n)=>{const e=g(),r=_(e,o,t(o),...n);return S(e),r},k=(o,n,e)=>{if(e.m&&!E(e.v)){for(const r of e.d.keys())e.m.d.has(r)||(j(o,r,t(r,e)).t.add(n),e.m.d.add(r));for(const r of e.m.d||[])if(!e.d.has(r)){e.m.d.delete(r);const f=D(o,r,t(r,e));f==null||f.t.delete(n)}}},j=(o,n,e)=>{if(!e.m){l(o,n,e);for(const r of e.d.keys())j(o,r,t(r,e)).t.add(n);if(e.m={l:new Set,d:new Set(e.d.keys()),t:new Set},B(n)&&n.onMount){const r=e.m,{onMount:f}=n;L(o,()=>{const c=f((...a)=>_(o,n,e,...a));c&&(r.u=c)})}}return e.m},D=(o,n,e)=>{if(e.m&&!e.m.l.size&&!Array.from(e.m.t).some(r=>{var f;return(f=t(r,e).m)==null?void 0:f.d.has(n)})){const r=e.m.u;r&&L(o,r),delete e.m;for(const f of e.d.keys()){const c=D(o,f,t(f,e));c==null||c.t.delete(n)}return}return e.m};return{get:d,set:P,sub:(o,n)=>{const e=g(),r=t(o),f=j(e,o,r);S(e);const c=f.l;return c.add(n),()=>{c.delete(n);const a=g();D(a,o,r),S(a)}},unstable_derive:o=>N(...o(t))}},Q=M("createStore",()=>{const t=new WeakMap;return N(s=>{let l=t.get(s);return l||(l={d:new Map,p:new Set,n:0},t.set(s,l)),l})});let C;const V=M("getDefaultStore",()=>(C||(C=Q()),C))}}});
